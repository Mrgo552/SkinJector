<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SkinJector</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(#1b1b1b, #111);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
    color: white;
}
.container {
    background: #222;
    border: 2px solid #3c8527;
    border-radius: 8px;
    padding: 30px;
    width: 400px;
    box-shadow: 0 0 25px rgba(0,0,0,0.8);
}
h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: 18px;
    color: #6cc349;
    text-align: center;
}
label {
    font-size: 12px;
    margin-top: 10px;
    display: block;
}
input, select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    background: #111;
    color: white;
    border: 1px solid #555;
    border-radius: 4px;
}
button {
    width: 100%;
    margin-top: 15px;
    padding: 12px;
    background: #3c8527;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
}
button:hover {
    background: #55aa3f;
}
footer {
    margin-top: 10px;
    font-size: 11px;
    text-align: center;
    color: #888;
}
</style>
</head>

<body>
<div class="container">
    <h1>SkinJector</h1>

    <label>Username</label>
    <input id="username" placeholder="Steve" maxlength="16">

    <label>Game version</label>
    <select id="mcVersion">
        <option value="1">1.8 – 1.10</option>
        <option value="3">1.11 – 1.12</option>
        <option value="4">1.13 – 1.14</option>
        <option value="5">1.15 – 1.16.1</option>
        <option value="6">1.16.2 – 1.17</option>
        <option value="8" selected>1.18 – 1.19</option>
    </select>

    <label>Skin (PNG)</label>
    <input type="file" id="skinInput" accept="image/png">

    <button onclick="generatePack()">Generate Resource Pack</button>

    <footer>Minecraft ≤ 1.19</footer>
</div>

<script>
async function generatePack() {
    const skinInput = document.getElementById("skinInput");
    const usernameRaw = document.getElementById("username").value.trim();
    const packFormat = Number(document.getElementById("mcVersion").value);

    if (!usernameRaw || !skinInput.files.length) {
        alert("Username and skin required.");
        return;
    }

    const username = usernameRaw.replace(/[^a-zA-Z0-9_]/g, "");
    const packName = `${username} Skin Pack`;

    const skinFile = skinInput.files[0];
    const img = new Image();
    img.src = URL.createObjectURL(skinFile);
    await img.decode();

    // Create pack icon safely
    const canvas = document.createElement("canvas");
    canvas.width = 64;
    canvas.height = 64;
    const ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = false;

    ctx.drawImage(img, 8, 8, 8, 8, 0, 0, 64, 64);

    const dataURL = canvas.toDataURL("image/png");
    const packIcon = Uint8Array.from(atob(dataURL.split(",")[1]), c => c.charCodeAt(0));

    const zip = new JSZip();

    zip.file("pack.mcmeta", JSON.stringify({
        pack: {
            pack_format: packFormat,
            description: packName
        }
    }, null, 2));

    zip.file("pack.png", packIcon);
    zip.file("assets/minecraft/textures/entity/steve.png", await skinFile.arrayBuffer());

    const blob = await zip.generateAsync({ type: "blob" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `${packName}.zip`;
    a.click();
}
</script>
</body>
</html>
