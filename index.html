<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SkinJector</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(#1b1b1b, #111);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
    color: white;
}
.container {
    background: #222;
    border: 2px solid #3c8527;
    border-radius: 8px;
    padding: 30px;
    width: 420px;
    box-shadow: 0 0 25px rgba(0,0,0,0.8);
}
h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: 18px;
    color: #6cc349;
    text-align: center;
    margin-bottom: 15px;
}
p {
    font-size: 13px;
    color: #ccc;
    text-align: center;
}
label {
    font-size: 12px;
    margin-top: 12px;
    display: block;
}
input, select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    background: #111;
    color: white;
    border: 1px solid #555;
    border-radius: 4px;
}
button {
    width: 100%;
    margin-top: 18px;
    padding: 12px;
    background: #3c8527;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 4px;
}
button:hover {
    background: #55aa3f;
}
footer {
    margin-top: 12px;
    font-size: 11px;
    text-align: center;
    color: #888;
}
</style>
</head>

<body>
<div class="container">
    <h1>SkinJector</h1>
    <p>Generate a resource pack to use custom skins in non-premium Minecraft</p>

    <label>Username</label>
    <input id="username" placeholder="Steve" maxlength="16">

    <label>Game version</label>
    <select id="mcVersion">
        <option value="8">1.8 – 1.19.2</option>
        <option value="34" selected>1.19.3 – 1.21+</option>
    </select>

    <label>Skin (PNG)</label>
    <input type="file" id="skinInput" accept="image/png">

    <button onclick="generatePack()">Generate Resource Pack</button>

    <footer>Compatible with Minecraft 1.8 – 1.21+</footer>
</div>

<script>
async function generatePack() {
    const skinInput = document.getElementById("skinInput");
    const usernameRaw = document.getElementById("username").value.trim();
    const packFormat = Number(document.getElementById("mcVersion").value);

    if (!usernameRaw || !skinInput.files.length) {
        alert("Username and skin are required.");
        return;
    }

    const username = usernameRaw.replace(/[^a-zA-Z0-9_]/g, "");
    
    // Determinar rango de versión para el nombre del archivo
    const versionRange = packFormat >= 12 ? "1.19.3-1.21+" : "1.8-1.19.2";
    const packName = `${username} Skin Pack ${versionRange}`;

    const skinFile = skinInput.files[0];

    // Leer la skin una sola vez
    const skinBuffer = await skinFile.arrayBuffer();

    // Cargar imagen para icono
    const img = new Image();
    img.src = URL.createObjectURL(skinFile);
    await img.decode();

    // Crear icono del pack (cara)
    const canvas = document.createElement("canvas");
    canvas.width = 64;
    canvas.height = 64;
    const ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = false;

    ctx.drawImage(img, 8, 8, 8, 8, 0, 0, 64, 64);

    const iconDataURL = canvas.toDataURL("image/png");
    const packIcon = Uint8Array.from(
        atob(iconDataURL.split(",")[1]),
        c => c.charCodeAt(0)
    );

    const zip = new JSZip();

    // pack.mcmeta
    zip.file("pack.mcmeta", JSON.stringify({
        pack: {
            pack_format: packFormat,
            description: packName
        }
    }, null, 2));

    // Determinar qué skins reemplazar según la versión
    const isModernVersion = packFormat >= 12; // 1.19.3+

    if (isModernVersion) {
        // VERSIONES 1.19.3+ (Con las nuevas 7 skins + Steve y Alex)
        const wideSkins = ['steve', 'ari', 'efe', 'kai', 'makena', 'noor', 'sunny', 'zuri','alex'];
        const slimSkins = ['alex', 'ari', 'efe', 'kai', 'makena', 'noor', 'sunny', 'zuri','steve'];
        
        // Wide (modelo Steve)
        wideSkins.forEach(skinName => {
            zip.file(`assets/minecraft/textures/entity/player/wide/${skinName}.png`, skinBuffer);
        });
        
        // Slim (modelo Alex)
        slimSkins.forEach(skinName => {
            zip.file(`assets/minecraft/textures/entity/player/slim/${skinName}.png`, skinBuffer);
        });
        
    } else {
        // VERSIONES 1.8 - 1.19.2 (Steve y Alex tradicionales)
        zip.file("assets/minecraft/textures/entity/steve.png", skinBuffer);
        zip.file("assets/minecraft/textures/entity/alex.png", skinBuffer);
    }

    // Icono del pack
    zip.file("pack.png", packIcon);

    // Generar ZIP
    const blob = await zip.generateAsync({ type: "blob" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `${packName}.zip`;
    a.click();
}
</script>
</body>
</html>
